<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8"><title>Admin - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏π‡∏ò</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../config.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f7f6; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 900px; margin: auto; }
        .flex { display: flex; justify-content: space-between; align-items: center; }
        select { padding: 10px; width: 200px; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        .btn { padding: 8px 15px; border-radius: 5px; cursor: pointer; border: none; text-decoration: none; }
        .btn-copy { background: #3498db; color: white; }
        .btn-report { background: #e67e22; color: white; }
    </style>
</head>
<body>
<div class="card">
    <div class="flex">
        <h1>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏π‡∏ò‡∏ï‡∏≤‡∏° Event</h1>
        <a href="report.html" class="btn btn-report">üìä ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</a>
       
    </div>
    
    <div style="margin: 20px 0;">
        <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Event: </label>
        <select id="event-select" onchange="loadBooths()"><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏≤‡∏ô --</option></select>
    </div>
    <table>
        <thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏π‡∏ò</th><th>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th><th>‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</th></tr></thead>
        <tbody id="booth-table"></tbody>
    </table>
</div>

<script>
    const STAFF_PAGE_URL = window.location.origin + "/staff/sell.html";

    async function init() {
        const { data } = await _supabase.from('events').select('*');
        const select = document.getElementById('event-select');
        data.forEach(ev => select.innerHTML += `<option value="${ev.id}">${ev.event_name}</option>`);
    }

    async function loadBooths() {
        const evId = document.getElementById('event-select').value;
        const { data } = await _supabase.from('booths').select('*').eq('event_id', evId);
        const tbody = document.getElementById('booth-table');
        tbody.innerHTML = data.map(b => {
            const url = `${STAFF_PAGE_URL}?id=${b.id}&event_id=${evId}`;
            return `<tr><td>${b.booth_name}</td>
                    <td><input type="text" value="${url}" id="u-${b.id}" readonly></td>
                    <td><button class="btn btn-copy" onclick="copy('${b.id}')">Copy</button></td></tr>`;
        }).join('');
    }

    function copy(id) {
        const el = document.getElementById('u-' + id); el.select();
        navigator.clipboard.writeText(el.value); alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß');
    }
    init();
</script>
</body>
</html>